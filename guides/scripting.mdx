---
title: Scripting tmux
description: Automating tmux with scripts and commands
---

## Overview

tmux provides powerful scripting capabilities for automation, including conditional execution, shell integration, and event-driven hooks. You can create complex workflows and automate repetitive tasks.

## Script Execution

### Run-Shell Command

<CodeGroup>

```bash Basic Run-Shell
# Execute shell command from tmux
run-shell "ls -la ~"

# Short form
run "ls -la ~"
```

```bash With Delay
# Run after delay (seconds)
run -d 2 "echo 'Delayed execution'"

# Useful for sequencing
run "first_command"
run -d 1 "second_command"
run -d 2 "third_command"
```

```bash Background Execution
# Run in background (default)
run -b "long_running_command"

# Equivalent to
run "long_running_command &"
```

```bash Capture Output
# Output goes to tmux's message area
run "date"

# Or to a pane
run "echo 'Result:' ; some_command"
```

</CodeGroup>

### If-Shell Command

From tmux.1 manual, conditional execution:

<Tabs>
  <Tab title="Basic Syntax">
    ```bash
    # Execute command if shell command succeeds
    if-shell "test -f ~/.tmux.local" "source ~/.tmux.local"
    
    # Short form
    if "test -f ~/.tmux.local" "source ~/.tmux.local"
    ```
  </Tab>

  <Tab title="With Else Clause">
    ```bash
    # Execute command based on condition
    if-shell "test -f ~/.tmux.local" {
        source ~/.tmux.local
        display "Loaded local config"
    } {
        display "No local config found"
    }
    ```
  </Tab>

  <Tab title="Format Conditions">
    ```bash
    # Use -F for format-based conditions
    if-shell -F '#{==:#{host},myhost}' {
        set -g status-bg red
    } {
        set -g status-bg blue
    }
    
    # Check if pane is zoomed
    if-shell -F '#{window_zoomed_flag}' {
        resize-pane -Z
    }
    ```
  </Tab>

  <Tab title="With Target">
    ```bash
    # Execute for specific target
    if-shell -t 0 "pgrep vim" {
        display "vim is running in pane 0"
    }
    ```
  </Tab>
</Tabs>

## Format Strings

### Conditional Formats

<CodeGroup>

```bash Equality Check
# Check if values are equal
#{==:#{session_name},mysession}

# Use in if-shell
if-shell -F '#{==:#{host},laptop}' {
    # Laptop-specific config
}
```

```bash Comparison
# Greater than
#{>:#{window_panes},1}

# Less than
#{<:#{pane_width},80}

# Greater or equal
#{>=:#{window_windows},5}
```

```bash Logical Operators
# OR
#{||:#{pane_in_mode},#{window_zoomed_flag}}

# AND
#{&&:#{window_active},#{pane_synchronized}}

# NOT (using ==:0)
#{==:#{window_zoomed_flag},0}
```

```bash Ternary Operator
# If-then-else in format
#{?window_zoomed_flag,ZOOMED,NORMAL}

# Nested conditions
#{?#{==:#{pane_current_command},vim},VIM,#{?#{==:#{pane_current_command},bash},BASH,OTHER}}
```

</CodeGroup>

### String Manipulation

<Accordion title="Format Functions">

```bash
# Length
#{l:#{session_name}}

# Substring (start:length)
#{=10:#{pane_title}}        # First 10 chars
#{=-10:#{pane_title}}       # Last 10 chars

# Pad
#{p10:#{window_index}}      # Pad to 10 chars

# Replace
#{s/old/new/:#{window_name}}     # Replace first
#{s/old/new/g:#{window_name}}    # Replace all

# Uppercase/Lowercase  
#{u:#{session_name}}        # Uppercase
#{U:#{session_name}}        # Uppercase first char
#{l:#{session_name}}        # Lowercase

# Time formatting
#{t:#{window_activity}}     # Format as time
#{t/f:#{window_activity}}   # Custom format

# Shell quoting
#{q:#{pane_title}}          # Shell quote
```

</Accordion>

## Automation Patterns

### Session Management Scripts

<Steps>

<Step title="Create Project Session">
```bash
#!/bin/bash
# save as: ~/bin/tmux-project

SESSION="myproject"

# Check if session exists
tmux has-session -t $SESSION 2>/dev/null

if [ $? != 0 ]; then
    # Create new session detached
    tmux new-session -d -s $SESSION -n editor
    
    # Window 1: Editor
    tmux send-keys -t $SESSION:editor "cd ~/projects/myproject" C-m
    tmux send-keys -t $SESSION:editor "vim" C-m
    
    # Window 2: Server
    tmux new-window -t $SESSION -n server
    tmux send-keys -t $SESSION:server "cd ~/projects/myproject" C-m
    tmux send-keys -t $SESSION:server "npm run dev" C-m
    
    # Window 3: Shell
    tmux new-window -t $SESSION -n shell
    tmux send-keys -t $SESSION:shell "cd ~/projects/myproject" C-m
    
    # Window 4: Git
    tmux new-window -t $SESSION -n git
    tmux send-keys -t $SESSION:git "cd ~/projects/myproject" C-m
    tmux send-keys -t $SESSION:git "git status" C-m
    
    # Select first window
    tmux select-window -t $SESSION:editor
fi

# Attach to session
tmux attach-session -t $SESSION
```
</Step>

<Step title="Multi-Pane Layout">
```bash
#!/bin/bash
# Create development layout

SESSION="dev"
tmux new-session -d -s $SESSION

# Split into 4 panes
tmux split-window -h -t $SESSION
tmux split-window -v -t $SESSION:0.0
tmux split-window -v -t $SESSION:0.2

# Set pane sizes
tmux resize-pane -t $SESSION:0.0 -x 80
tmux resize-pane -t $SESSION:0.1 -x 80

# Start commands in each pane
tmux send-keys -t $SESSION:0.0 "vim" C-m
tmux send-keys -t $SESSION:0.1 "git status" C-m
tmux send-keys -t $SESSION:0.2 "npm run dev" C-m
tmux send-keys -t $SESSION:0.3 "tail -f logs/app.log" C-m

# Attach
tmux attach -t $SESSION
```
</Step>

</Steps>

### Conditional Configuration

<CodeGroup>

```bash Platform Detection
# Linux-specific config
if-shell "uname | grep -q Linux" {
    set -g status-bg green
    bind C-c run "xclip -selection clipboard"
}

# macOS-specific config
if-shell "uname | grep -q Darwin" {
    set -g status-bg blue
    bind C-c run "pbcopy"
}

# BSD-specific config
if-shell "uname | grep -q BSD" {
    set -g status-bg yellow
}
```

```bash Environment Detection
# Check if inside tmux
if-shell '[ -n "$TMUX" ]' {
    set -g status-bg red
}

# Check SSH connection
if-shell '[ -n "$SSH_CONNECTION" ]' {
    set -g status-bg magenta
    set -g status-left "[SSH] #S "
}

# Check if file exists
if-shell 'test -f ~/.tmux.local.conf' {
    source-file ~/.tmux.local.conf
}
```

```bash Version Detection
# Different config for tmux versions
if-shell '[ $(tmux -V | cut -d" " -f2 | tr -d ".") -ge 32 ]' {
    # tmux 3.2+
    set -g allow-passthrough on
} {
    # Older versions
    display "tmux version < 3.2"
}
```

</CodeGroup>

### Dynamic Status Line

From `status.c:194-200`, status updates periodically:

<CodeGroup>

```bash System Monitoring
# CPU and memory in status line
set -g status-right "CPU: #(top -bn1 | grep 'Cpu' | awk '{print $2}')% | "
set -ag status-right "Mem: #(free -h | awk '/Mem:/ {print $3"/"$2}') | "
set -ag status-right "%H:%M"

set -g status-interval 5
```

```bash Git Status
# Show git branch in status
set -g status-right "#(cd #{pane_current_path}; git rev-parse --abbrev-ref HEAD 2>/dev/null) | %H:%M"
```

```bash Custom Script
# Use external script
set -g status-right "#(~/.tmux/status.sh)"

# ~/.tmux/status.sh:
#!/bin/bash
LOAD=$(uptime | awk '{print $(NF-2)}' | tr -d ',')
MEM=$(free -h | awk '/Mem:/ {print $3}')
echo "‚ö°$LOAD üß†$MEM"
```

```bash Conditional Display
# Show different info based on condition
set -g status-right "#{?#{==:#{host},laptop},üíª,üñ•Ô∏è} #H | %H:%M"
```

</CodeGroup>

## Hooks

### Available Hooks

<Tabs>
  <Tab title="Session Hooks">
    ```bash
    # After new session created
    set-hook -g after-new-session {
        display "Welcome to tmux!"
    }
    
    # After session renamed
    set-hook -g after-rename-session {
        display "Session renamed to #{session_name}"
    }
    
    # Before session destroyed
    set-hook -g session-closed {
        run "echo 'Session closed' >> ~/tmux.log"
    }
    ```
  </Tab>

  <Tab title="Window Hooks">
    ```bash
    # After window created
    set-hook -g after-new-window {
        display "New window: #{window_index}"
    }
    
    # Before window closes
    set-hook -g window-unlinked {
        run "notify-send 'Window closed'"
    }
    
    # After window renamed
    set-hook -g after-rename-window {
        run "echo 'Window renamed' >> ~/tmux.log"
    }
    ```
  </Tab>

  <Tab title="Pane Hooks">
    ```bash
    # After pane created  
    set-hook -g after-split-window {
        select-layout tiled
    }
    
    # Before pane dies
    set-hook -g pane-died {
        display "Pane #{pane_id} exited"
    }
    
    # When pane focus changes
    set-hook -g after-select-pane {
        run "~/.tmux/focus-changed.sh #{pane_id}"
    }
    ```
  </Tab>

  <Tab title="Client Hooks">
    ```bash
    # Client attached
    set-hook -g client-attached {
        display "Welcome #{client_name}"
    }
    
    # Client detached
    set-hook -g client-detached {
        run "echo 'Client detached' >> ~/tmux.log"
    }
    
    # Client session changed
    set-hook -g client-session-changed {
        refresh-client -S
    }
    ```
  </Tab>
</Tabs>

### Hook Examples

<CodeGroup>

```bash Auto-Layout
# Automatically arrange panes
set-hook -g after-split-window {
    select-layout tiled
}

set-hook -g pane-exited {
    select-layout tiled
}
```

```bash Auto-Rename
# Auto-rename window based on command
set-hook -g after-select-pane {
    if-shell -F '#{==:#{pane_current_command},vim}' {
        rename-window "VIM"
    } {
        if-shell -F '#{==:#{pane_current_command},ssh}' {
            rename-window "SSH"
        } {
            automatic-rename on
        }
    }
}
```

```bash Logging
# Log all session activity
set-hook -g after-new-session {
    run "echo '[$(date)] New session: #{session_name}' >> ~/tmux-activity.log"
}

set-hook -g session-closed {
    run "echo '[$(date)] Session closed: #{session_name}' >> ~/tmux-activity.log"
}
```

```bash Notifications
# Desktop notifications
set-hook -g pane-died {
    run "notify-send 'tmux' 'Process in pane #{pane_id} exited'"
}

set-hook -g alert-bell {
    run "notify-send 'tmux' 'Bell in window #{window_index}'"
}
```

</CodeGroup>

## Advanced Scripting

### Command Sequences

```bash
# Multiple commands with different behavior

# Sequential (stop on error)
new-window \; split-window \; select-layout even-horizontal

# Continue on error (use ;)
kill-window -t 1 ; kill-window -t 2 ; new-window

# Conditional sequence
if-shell "test -f ~/.tmux.local" {
    source ~/.tmux.local
    display "Loaded local config"
} {
    display "No local config"
}
```

### Variable Expansion

<CodeGroup>

```bash Environment Variables
# Access environment
set -g status-right "User: $USER | Host: $HOSTNAME"

# With formats
set -g status-right "#{E:USER}@#{host}"

# Set environment
setenv -g MY_VAR value
run "echo $MY_VAR"
```

```bash Format Variables
# Store in option
set -g @custom_var "value"

# Access later
set -g status-right "Custom: #{@custom_var}"

# User options (@ prefix)
set -g @theme "dark"
if-shell -F '#{==:#{@theme},dark}' {
    set -g status-bg black
}
```

```bash Command Substitution
# Run command and use output
set -g status-right "#(date +%Y-%m-%d) %H:%M"

# Complex command
set -g status-right "#(ps aux | wc -l) processes"

# With format
set -g status-right "Dir: #(basename #{pane_current_path})"
```

</CodeGroup>

### External Scripts Integration

<Steps>

<Step title="Script Template">
```bash
#!/bin/bash
# ~/.tmux/scripts/helper.sh

# Get tmux info
SESSION=$(tmux display-message -p '#S')
WINDOW=$(tmux display-message -p '#I')
PANE=$(tmux display-message -p '#P')

echo "Session: $SESSION, Window: $WINDOW, Pane: $PANE"

# Execute tmux commands
tmux display-message "Script executed"
```
</Step>

<Step title="Call from tmux">
```bash
# In tmux.conf
bind-key S run-shell "~/.tmux/scripts/helper.sh"

# With arguments
bind-key T run-shell "~/.tmux/scripts/helper.sh #{session_name}"
```
</Step>

<Step title="Return Status">
```bash
#!/bin/bash
# Script with status check

if [ -f ~/.tmux.local.conf ]; then
    tmux source-file ~/.tmux.local.conf
    tmux display "Local config loaded"
    exit 0
else
    tmux display "No local config found"
    exit 1
fi
```
</Step>

</Steps>

## Practical Automation

### Session Switcher

```bash
# Bind to fuzzy session switcher
bind-key s run-shell "tmux list-sessions -F '#{session_name}' | \
    fzf-tmux -p | \
    xargs tmux switch-client -t"

# Or with preview
bind-key s run-shell "tmux list-sessions -F '#{session_name}' | \
    fzf-tmux -p --preview 'tmux capture-pane -t {} -p' | \
    xargs tmux switch-client -t"
```

### Window Manager

```bash
# Kill all windows except current
bind-key X confirm-before -p "Kill all other windows? (y/n)" \
    "run-shell 'tmux list-windows | \
    grep -v active | \
    cut -d: -f1 | \
    xargs -I {} tmux kill-window -t {}'"

# Reorder windows
bind-key O run-shell "tmux move-window -r"
```

### Backup and Restore

<CodeGroup>

```bash Save Layout
#!/bin/bash
# ~/.tmux/scripts/save-layout.sh

SESSION=$(tmux display-message -p '#S')
LAYOUT_FILE=~/.tmux/layouts/${SESSION}.layout

mkdir -p ~/.tmux/layouts

# Save window layouts
tmux list-windows -t $SESSION -F '#{window_index} #{window_layout}' > $LAYOUT_FILE

echo "Layout saved for session $SESSION"
```

```bash Restore Layout
#!/bin/bash
# ~/.tmux/scripts/restore-layout.sh

SESSION=$1
LAYOUT_FILE=~/.tmux/layouts/${SESSION}.layout

if [ -f $LAYOUT_FILE ]; then
    while read window_index layout; do
        tmux select-layout -t ${SESSION}:${window_index} "$layout"
    done < $LAYOUT_FILE
    echo "Layout restored for session $SESSION"
else
    echo "No layout file found for $SESSION"
fi
```

</CodeGroup>

### Workspace Manager

```bash
#!/bin/bash
# ~/.tmux/scripts/workspace.sh
# Manage project workspaces

WORKSPACE=$1
WORKSPACE_DIR=~/.tmux/workspaces

case "$WORKSPACE" in
    save)
        SESSION=$(tmux display-message -p '#S')
        FILE="$WORKSPACE_DIR/${SESSION}.sh"
        mkdir -p $WORKSPACE_DIR
        
        # Generate recreation script
        echo "#!/bin/bash" > $FILE
        echo "tmux new-session -d -s $SESSION" >> $FILE
        
        tmux list-windows -t $SESSION -F '#{window_index} #{window_name} #{pane_current_path}' | \
        while read idx name path; do
            echo "tmux new-window -t ${SESSION}:${idx} -n '$name' -c '$path'" >> $FILE
        done
        
        chmod +x $FILE
        echo "Workspace saved: $FILE"
        ;;
    
    load)
        SESSION=$2
        FILE="$WORKSPACE_DIR/${SESSION}.sh"
        
        if [ -f $FILE ]; then
            $FILE
            tmux attach -t $SESSION
        else
            echo "Workspace not found: $SESSION"
        fi
        ;;
    
    list)
        ls -1 $WORKSPACE_DIR/*.sh 2>/dev/null | xargs -n1 basename | sed 's/.sh$//'
        ;;
    
    *)
        echo "Usage: workspace {save|load SESSION|list}"
        exit 1
        ;;
esac
```

## Debugging Scripts

### Show Errors

```bash
# Display error messages
set -g display-time 4000

# Show command output
run-shell -b "command 2>&1 | head -20"

# Log to file
run-shell "command >> ~/tmux-debug.log 2>&1"
```

### Test Commands

```bash
# Test if-shell conditions
tmux if-shell -F '#{==:#{host},myhost}' \
    "display 'Match'" \
    "display 'No match'"

# Test format strings
tmux display-message -p '#{session_name}'
tmux display-message -p '#{?window_zoomed_flag,yes,no}'
```

## Performance Tips

<Tip>
**Script Performance:**

1. **Minimize status-interval** for frequently-run scripts
2. **Cache expensive operations** rather than recomputing
3. **Use formats instead of shell** when possible
4. **Background long-running commands** with `run -b`
5. **Limit output** from status bar commands

```bash
# Good: Native format
set -g status-right '#{session_windows} windows'

# Slower: Shell command every interval
set -g status-right '#(tmux list-windows | wc -l) windows'

# Cache expensive data
run-shell -b "expensive_command > /tmp/tmux-cache"
set -g status-right '#(cat /tmp/tmux-cache)'
```
</Tip>

## See Also

- [Configuration](/guides/configuration) - Configuration file format
- [Key Bindings](/guides/key-bindings) - Bind scripts to keys
- [Status Line](/guides/status-line) - Dynamic status updates
